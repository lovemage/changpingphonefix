<!doctype html>
<html lang="zh-TW">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>CMS 測試頁面 - Marco Academic</title>
  <style>
    body {font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Noto Sans TC", Arial, sans-serif; margin:0; padding:20px;}
    .container {max-width: 1060px; margin: 0 auto;}
    .test-section {margin: 20px 0; padding: 20px; border: 1px solid #ddd; border-radius: 8px;}
    .test-section h3 {margin-top: 0; color: #333;}
    .loading {color: #666; font-style: italic;}
    .error {color: #d32f2f; background: #ffebee; padding: 10px; border-radius: 4px;}
    .success {color: #2e7d32; background: #e8f5e9; padding: 10px; border-radius: 4px;}
    .data-item {margin: 10px 0; padding: 10px; background: #f5f5f5; border-radius: 4px;}
    .data-item h4 {margin: 0 0 5px 0; color: #1976d2;}
    .data-item p {margin: 5px 0; font-size: 14px; color: #666;}
  </style>
</head>
<body>
  <div class="container">
    <h1>Marco Academic - CMS 功能測試</h1>
    <p>此頁面用於測試 CMS 資料載入功能是否正常運作。</p>

    <div class="test-section">
      <h3>房產項目載入測試</h3>
      <div id="properties-test">
        <div class="loading">正在載入房產項目...</div>
      </div>
    </div>

    <div class="test-section">
      <h3>文章載入測試</h3>
      <div id="articles-test">
        <div class="loading">正在載入文章...</div>
      </div>
    </div>

    <div class="test-section">
      <h3>控制台日誌</h3>
      <div id="console-log">
        <p>請打開瀏覽器開發者工具查看詳細日誌。</p>
      </div>
    </div>
  </div>

  <script src="https://code.jquery.com/jquery-3.7.1.min.js" integrity="sha256-/JqT3SQfawRcv/BIHPThkBvs0OEvtFFmqPF/lYI/Cxo=" crossorigin="anonymous"></script>
  <script src="js/cms-loader.js"></script>
  <script>
    // 自定義測試函數
    async function testCMSLoading() {
      const loader = new CMSLoader();
      
      try {
        // 測試房產項目載入
        console.log('開始測試房產項目載入...');
        const properties = await loader.loadProperties();
        console.log('房產項目載入結果:', properties);
        
        const propertiesContainer = document.getElementById('properties-test');
        if (properties && properties.length > 0) {
          propertiesContainer.innerHTML = `
            <div class="success">成功載入 ${properties.length} 個房產項目</div>
            ${properties.slice(0, 3).map(prop => `
              <div class="data-item">
                <h4>${prop.title}</h4>
                <p><strong>類別:</strong> ${prop.category || 'N/A'}</p>
                <p><strong>描述:</strong> ${prop.description ? prop.description.substring(0, 100) + '...' : 'N/A'}</p>
                <p><strong>圖片:</strong> ${prop.image || 'N/A'}</p>
              </div>
            `).join('')}
          `;
        } else {
          propertiesContainer.innerHTML = '<div class="error">房產項目載入失敗或無資料</div>';
        }

        // 測試文章載入
        console.log('開始測試文章載入...');
        const articles = await loader.loadArticles();
        console.log('文章載入結果:', articles);
        
        const articlesContainer = document.getElementById('articles-test');
        if (articles && articles.length > 0) {
          articlesContainer.innerHTML = `
            <div class="success">成功載入 ${articles.length} 篇文章</div>
            ${articles.slice(0, 3).map(article => `
              <div class="data-item">
                <h4>${article.title}</h4>
                <p><strong>作者:</strong> ${article.author || 'N/A'}</p>
                <p><strong>日期:</strong> ${article.date || 'N/A'}</p>
                <p><strong>摘要:</strong> ${article.excerpt ? article.excerpt.substring(0, 100) + '...' : 'N/A'}</p>
              </div>
            `).join('')}
          `;
        } else {
          articlesContainer.innerHTML = '<div class="error">文章載入失敗或無資料</div>';
        }

      } catch (error) {
        console.error('CMS 測試過程中發生錯誤:', error);
        document.getElementById('properties-test').innerHTML = `<div class="error">測試失敗: ${error.message}</div>`;
        document.getElementById('articles-test').innerHTML = `<div class="error">測試失敗: ${error.message}</div>`;
      }
    }

    // 頁面載入完成後執行測試
    $(document).ready(function() {
      console.log('頁面載入完成，開始 CMS 測試...');
      setTimeout(testCMSLoading, 1000); // 延遲1秒執行測試
    });
  </script>
</body>
</html>
